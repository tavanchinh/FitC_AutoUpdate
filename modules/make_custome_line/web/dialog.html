<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f8f8f8; }
        .container { display: flex; flex-direction: column; gap: 10px; }
        label { font-weight: bold; font-size: 13px; color: #444; }
        select, input { padding: 10px; border: 1px solid #aaa; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .hidden { display: none; }
        button { margin-top: 10px; padding: 12px; background: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button:hover { background: #27ae60; }
    </style>
</head>
<body>
    <div class="container">
        <label>Chọn Layer:</label>
        <select id="layerSelect" onchange="toggleNewLayerInput()">
            <option value="NEW">-- Tạo Layer mới --</option>
        </select>
        <div id="newLayerContainer">
            <label>Tên Layer mới:</label>
            <input type="text" id="newLayerName" placeholder="VD: ABF_SOI">
        </div>
        <button onclick="sendData()">THỰC HIỆN</button>
    </div>
    <script>
        // 1. Khi trang web tải xong hoàn toàn, báo cho Ruby biết
        document.addEventListener("DOMContentLoaded", () => {
            sketchup.get_layers_from_ruby();
        });

        window.populateLayers = (layers) => {
            const select = document.getElementById('layerSelect');
            select.innerHTML = '<option value="NEW">-- Tạo Layer mới --</option>'; // Xóa cũ
            
            layers.forEach(name => {
                let opt = document.createElement('option');
                opt.value = name; opt.text = name;
                select.appendChild(opt);
            });
            
            if (layers.length > 0) {
                select.value = layers[0];
                toggleNewLayerInput();
            }
        };
        
        // ... các hàm toggleNewLayerInput và sendData giữ nguyên ...

        function toggleNewLayerInput() {
            const select = document.getElementById('layerSelect');
            const newLayerContainer = document.getElementById('newLayerContainer');
            if (select.value === "NEW") {
                newLayerContainer.classList.remove('hidden');
            } else {
                newLayerContainer.classList.add('hidden');
            }
        }

        function sendData() {
            const select = document.getElementById('layerSelect');
            let name = (select.value === "NEW") ? document.getElementById('newLayerName').value : select.value;
            if (name.trim() === "") {
                alert("Vui lòng nhập tên layer!");
            } else {
                sketchup.process_logic(name);
            }

        }
    </script>
</body>
</html>